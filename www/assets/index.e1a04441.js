import{o as g}from"./back.9355f2a3.js";import{d as w,r as v,c as e,a as r,C as V,w as j,o as z,g as N,b as s,R as W,S as R,T as b,U}from"./index.a0335495.js";import{a as O,r as P,b as G,c as H,d as K}from"./index.81dbf185.js";import{D as f}from"./function-call.e62a170f.js";const M="_icon_y535y_4",X="_content_y535y_43",a={"empty-wrapper":"_empty-wrapper_y535y_1","icon-bind":"_icon-bind_y535y_4",icon:M,"text-wrapper":"_text-wrapper_y535y_14","bind-title":"_bind-title_y535y_20","bind-step":"_bind-step_y535y_26","bind-num":"_bind-num_y535y_31","btn-wrapper":"_btn-wrapper_y535y_35","nav-right":"_nav-right_y535y_39",content:X,"disk-info":"_disk-info_y535y_50","flex-box-between":"_flex-box-between_y535y_54","warehouse-place":"_warehouse-place_y535y_60","scan-icon":"_scan-icon_y535y_64","disk-info-box":"_disk-info-box_y535y_69","disk-info-left":"_disk-info-left_y535y_75","disk-info-right":"_disk-info-right_y535y_79","black-line":"_black-line_y535y_84","sample-info":"_sample-info_y535y_88","sample-title":"_sample-title_y535y_96","sample-list":"_sample-list_y535y_101","sample-list-padding":"_sample-list-padding_y535y_107","add-btn":"_add-btn_y535y_110","add-icon":"_add-icon_y535y_122","full-text":"_full-text_y535y_129","bottom-btn":"_bottom-btn_y535y_135","toggle-all-text":"_toggle-all-text_y535y_150","cancel-btn":"_cancel-btn_y535y_154","confirm-btn":"_confirm-btn_y535y_164"},_={"sample-check-item":"_sample-check-item_3qpjz_1","sample-check-num":"_sample-check-num_3qpjz_10","sample-item-cener":"_sample-item-cener_3qpjz_15","sample-item-name":"_sample-item-name_3qpjz_20","sample-item-no":"_sample-item-no_3qpjz_26"},$=w({name:"CheckItem",props:{name:{type:[String,Number],default:""},i:{type:Number,default:1},data:{type:Object,default:()=>({})}},setup(d){const k=i=>{i.stopPropagation()},n=v(),u=()=>{n.value.toggle()},c=i=>{const m=i+1;return m>9?m:"0"+m};return()=>e("div",{class:_["sample-check-item"],onClick:u},[e("div",{class:_["sample-check-num"]},[c(d.i)]),e("div",{class:_["sample-item-cener"]},[e("div",{class:_["sample-item-name"]},[d.data.sampleName]),e("div",{class:_["sample-item-no"]},[d.data.sampleCode])]),e("div",{class:_["check-box"]},[e("div",null,[e(r("van-checkbox"),{ref:n,name:d.name,onClick:i=>k(i)},null)])])])}});function J(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!W(d)}const te=w({name:"BindSample",setup(){const d=R(),k=v(!1),n=V({rackCode:"",rackCapacity:"",rackLong:"",rackWide:"",rackDescribe:""}),u=v();u.value=d.query.id,d.query.id&&(k.value=!0);const c=v([]),i=v([]),m=v(!1);j(c,()=>{c.value.length===i.value.length?m.value=!0:m.value=!1});const y=v(),A=()=>{var l,t;m.value?(l=y.value)==null||l.toggleAll(!0):(t=y.value)==null||t.toggleAll(!1)};let p=!1;const F=()=>{p=!0,cordova.plugins.barcodeScanner.scan(function(l){if(l.text){const t=b.loading({message:"\u52A0\u8F7D\u4E2D...",duration:0,mask:!0});O({sampleCode:l.text}).then(o=>{var D;t.clear(),(D=o.data)!=null&&D.data?i.value.findIndex(I=>{var B;return I.id==((B=o.data.data)==null?void 0:B.id)})==-1?(i.value.push(o.data.data),T()):f.alert({title:"\u63D0\u793A",message:"\u6837\u54C1\u5DF2\u5728\u5217\u8868\u4E2D",confirmButtonColor:"#00A9A9"}):f.alert({title:"\u63D0\u793A",message:"\u6837\u54C1\u4E0D\u5B58\u5728",confirmButtonColor:"#00A9A9"})}).catch(()=>{t.clear()})}setTimeout(()=>{p=!1},200)},function(){setTimeout(()=>{p=!1},200),f.alert({title:"\u63D0\u793A",message:"\u626B\u63CF\u5931\u8D25",confirmButtonColor:"#00A9A9"})})},S=()=>{f.confirm({title:"\u63D0\u793A",message:"\u5F53\u524D\u7ED1\u5B9A\u4FE1\u606F\u672A\u4FDD\u5B58\uFF0C\u662F\u5426\u4FDD\u5B58\uFF1F",confirmButtonText:"\u4FDD\u5B58",cancelButtonText:"\u4E0D\u4FDD\u5B58",cancelButtonColor:"#fff",confirmButtonColor:"#00A9A9"}).then(()=>{x(h)}).catch(()=>{q()})},h=()=>{p=!0,cordova.plugins.barcodeScanner.scan(async function(l){try{if(l.text){const t=await P({rackCode:l.text});t.data.data?(u.value=t.data.data.id,i.value=t.data.data.lists||[],n.rackCapacity=t.data.data.numberHoles,n.rackCode=l.text,n.rackDescribe=t.data.data.remarks,n.rackLong=t.data.data.rackLong,n.rackWide=t.data.data.rackWide):f.alert({title:"\u63D0\u793A",message:"\u76D8\u67B6\u4E0D\u5B58\u5728",confirmButtonColor:"#00A9A9"})}setTimeout(()=>{p=!1},200)}catch{setTimeout(()=>{p=!1},200)}},function(){setTimeout(()=>{p=!1},10),f.alert({title:"\u63D0\u793A",message:"\u626B\u63CF\u5931\u8D25",confirmButtonColor:"#00A9A9"})})},C=l=>{console.log(p),p?l.preventDefault():g()};z(()=>{document.addEventListener("backbutton",C)}),N(()=>{document.removeEventListener("backbutton",C)});const T=()=>{U(()=>{var l;(l=document.getElementById("scan-addd-btn"))==null||l.scrollIntoView({behavior:"smooth",block:"start"})})},L=()=>{if(u.value){const l=b.loading({message:"\u52A0\u8F7D\u4E2D...",duration:0,overlay:!0,mask:!0});G({id:u.value}).then(t=>{t.data.data&&(i.value=t.data.data.lists,n.rackCapacity=t.data.data.rackCapacity,n.rackCode=t.data.data.rackCode,n.rackDescribe=t.data.data.rackDescribe,n.rackLong=t.data.data.rackLong,n.rackWide=t.data.data.rackWide),l.clear()}).catch(()=>{console.log("adsfads")})}},q=()=>{n.rackCapacity="",n.rackCode="",n.rackLong="",n.rackWide="",n.rackDescribe="",i.value=[],u.value=""},E=()=>{for(let l=0;l<c.value.length;l++){const t=i.value.findIndex(o=>o.id==c.value[l]);i.value.splice(t,1)}c.value=[]};L();const x=async l=>{const t=b.loading({message:"\u4FDD\u5B58\u4E2D...",duration:0,mask:!0});try{k.value?await K({id:Number(u.value),ids:i.value.map(o=>o.id),rackDescribe:n.rackDescribe}):await H({id:Number(u.value),ids:i.value.map(o=>o.id),rackDescribe:n.rackDescribe}),t.clear(),b.success("\u4FDD\u5B58\u6210\u529F"),l&&typeof l=="function"&&setTimeout(()=>{l()},1e3)}catch{t.clear()}};return()=>{let l;return e("div",{class:a["bind-sample"]},[e(r("van-nav-bar"),{title:"\u6837\u54C1\u7ED1\u5B9A",fixed:!0,placeholder:!0,"left-arrow":!0,border:!1,onClickLeft:g},{right:()=>e("div",null,[u.value?e("div",{onClick:()=>x(g),class:a["nav-right"]},[s("\u4FDD\u5B58")]):null])}),u.value?e("div",{class:a.content},[e("div",{class:a["disk-info"]},[e("div",{class:a["flex-box-between"]},[e("div",{class:a["warehouse-place"]},[s("\u76D8\u67B6\u4FE1\u606F")]),k.value?null:e("div",{class:a["scan-icon"],onClick:S},[e(r("svg-icon"),{name:"icon-scans"},null)])]),e("div",{class:a["disk-info-box"]},[e("div",{class:a["disk-info-left"]},[s("\u76D8\u67B6\u7C7B\u578B")]),e("div",{class:a["disk-info-right"]},[n.rackWide,s("X"),n.rackLong," ",n.rackCapacity,s("mm")])]),e("div",{class:a["disk-info-box"]},[e("div",{class:a["disk-info-left"]},[s("\u76D8\u67B6\u7F16\u7801")]),e("div",{class:a["disk-info-right"]},[n.rackCode])]),e("div",{class:a["disk-info-box"]},[e("div",{class:a["disk-info-left"]},[s("\u76D8\u67B6\u63CF\u8FF0")]),e("div",{class:a["disk-info-right"]},[e(r("van-field"),{style:"padding: 0",modelValue:n.rackDescribe,"onUpdate:modelValue":t=>n.rackDescribe=t,placeholder:"\u8BF7\u8F93\u5165",autosize:!0},null)])])]),e("div",{class:a["black-line"]},null),e("div",{class:a["sample-info"]},[e("div",{class:a["sample-title"]},[s("\u6837\u54C1\u4FE1\u606F")]),e("div",{class:[a["sample-list"],c.value.length?a["sample-list-padding"]:null]},[e(r("van-checkbox-group"),{modelValue:c.value,"onUpdate:modelValue":t=>c.value=t,ref:y},J(l=i.value.map((t,o)=>e($,{name:t.id,i:o,data:t},null)))?l:{default:()=>[l]}),i.value.length>=n.rackCapacity?e("div",{class:a["full-text"]},[s("-\u6837\u54C1\u5DF2\u6EE1-")]):e("div",{class:a["add-btn"],onClick:F},[e("div",{class:a["add-icon"]},[e(r("svg-icon"),{name:"icon-scans"},null)]),e("div",{id:"scan-addd-btn",class:a["add-text"]},[s("\u6DFB\u52A0\u6837\u54C1")])])])]),c.value.length!=0?e("div",{class:a["bottom-btn"]},[e("div",null,[e(r("van-checkbox"),{modelValue:m.value,"onUpdate:modelValue":t=>m.value=t,onClick:A},{default:()=>[e("span",{class:a["toggle-all-text"]},[s("\u5168\u9009")])]})]),e("div",null,[e(r("van-button"),{onClick:()=>c.value=[],plain:!0,size:"small",class:a["cancel-btn"]},{default:()=>[s("\u53D6\u6D88")]}),e(r("van-button"),{onClick:E,size:"small",color:"#FF4747",class:a["confirm-btn"]},{default:()=>[s("\u79FB\u9664"),c.value.length,s("\u9879")]})])]):null]):e("div",{class:a["empty-wrapper"]},[e("div",{class:a["icon-bind"]},[e(r("svg-icon"),{name:"icon-bind",class:a.icon},null)]),e("div",{class:a["text-wrapper"]},[e("div",{class:a["bind-title"]},[s("\u5C06\u6837\u54C1\u7ED1\u5B9A\u5230\u76D8\u67B6\u4E2D")]),e("div",{class:a["bind-step"]},[e("span",{class:a["bind-num"]},[s("01")]),e("span",null,[s("\u626B\u63CF\u8981\u653E\u7F6E\u6837\u54C1\u7684\u76D8\u67B6")])]),e("div",{class:a["bind-step"]},[e("span",{class:a["bind-num"]},[s("02")]),e("span",null,[s("\u6DFB\u52A0\u8981\u68C0\u6D4B\u7684\u6837\u54C1")])])]),e("div",{class:a["btn-wrapper"]},[e(r("van-button"),{type:"primary",block:!0,onClick:h},{default:()=>[s("\u626B\u63CF\u76D8\u67B6")]})])])])}}});export{te as default};
