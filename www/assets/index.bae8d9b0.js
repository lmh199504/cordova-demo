import{o as R}from"./back.9355f2a3.js";import{e as B,d as E,f as q,r as v,w as M,c as e,a as c,b as f,F as A,o as V,g as H,T as w,u as J}from"./index.a0335495.js";import{P as D,W as I}from"./index.c8560d34.js";import{r as Q}from"./index.81dbf185.js";import{D as U}from"./function-call.e62a170f.js";import{r as Y,a as Z,b as ee}from"./index.9225a351.js";import{r as ae,a as se,b as ne}from"./index.2b7553c5.js";const te={"lib-manage":"_lib-manage_1uef2_1"},s={"sample-lib":"_sample-lib_i91mj_1","sample-wrapper":"_sample-wrapper_i91mj_4","plate-lenged":"_plate-lenged_i91mj_8","disk-rack-wrapper":"_disk-rack-wrapper_i91mj_11","disk-top":"_disk-top_i91mj_15","disk-info":"_disk-info_i91mj_20","disk-icon":"_disk-icon_i91mj_23","disk-text":"_disk-text_i91mj_28","disk-name":"_disk-name_i91mj_33","disk-no":"_disk-no_i91mj_37","disk-menu":"_disk-menu_i91mj_41","disk-list":"_disk-list_i91mj_51","disk-item":"_disk-item_i91mj_51","disk-item-index":"_disk-item-index_i91mj_59","disk-item-content":"_disk-item-content_i91mj_65","disk-item-name":"_disk-item-name_i91mj_65","disk-item-no":"_disk-item-no_i91mj_71","empty-wrapper":"_empty-wrapper_i91mj_76","select-btn":"_select-btn_i91mj_76","scan-btn":"_scan-btn_i91mj_89","scan-code":"_scan-code_i91mj_100","scan-icon":"_scan-icon_i91mj_116","scan-text":"_scan-text_i91mj_120","menu-list":"_menu-list_i91mj_125","menu-item":"_menu-item_i91mj_128","menu-name":"_menu-name_i91mj_132","menu-icon":"_menu-icon_i91mj_138"},ie="_checked_15yj6_75",P={"popup-content":"_popup-content_15yj6_1","popup-tool":"_popup-tool_15yj6_8","cancel-btn":"_cancel-btn_15yj6_17","popup-title":"_popup-title_15yj6_22","confirm-btn":"_confirm-btn_15yj6_27","list-wrapper":"_list-wrapper_15yj6_32","select-item":"_select-item_15yj6_38","select-item-left":"_select-item-left_15yj6_48","item-params":"_item-params_15yj6_52","item-desc":"_item-desc_15yj6_60","select-item-right":"_select-item-right_15yj6_68",checked:ie},le=()=>B({url:"/rk/rkSampleLibrary/getPositionOccupancy",method:"GET"}),oe=l=>B({url:"/rk/rkSampleLibrary/getByRackId",method:"GET",params:l}),F=()=>B({url:"/rk/rkSampleLibrary/getNotWarehousing",method:"GET"}),ue=l=>B({url:"/rk/rkSampleLibrary/allIssue",method:"GET",params:l}),ce=l=>B({url:"/rk/rkSampleLibrary/allWarehousing",method:"GET",params:l}),de=l=>B({url:"/rk/rkSampleLibrary/scanningAllWarehousing",method:"GET",params:l}),re=E({name:"SelectPopup",props:{show:{type:Boolean,default:!1}},emits:["update:show","confirm"],setup(l,{emit:y}){const _=q({get(){return l.show},set(u){y("update:show",u)}}),o=v(),r=()=>{_.value=!1},n=()=>{_.value=!1,o.value&&y("confirm",o.value),o.value=void 0},a=v([]);F();const g=()=>{F().then(u=>{a.value=u.data.data})},L=u=>{o.value=u.id};return M(()=>l.show,u=>{u&&g()}),()=>e(A,null,[e(c("van-popup"),{show:_.value,"onUpdate:show":u=>_.value=u,position:"bottom",round:!0},{default:()=>[e("div",{class:P["popup-content"]},[e("div",{class:P["popup-tool"]},[e("div",{class:P["cancel-btn"],onClick:r},[f("\u53D6\u6D88")]),e("div",{class:P["popup-title"]},[f("\u76D8\u67B6\u5165\u5E93")]),e("div",{class:P["confirm-btn"],onClick:n},[f("\u786E\u5B9A")])]),e("div",{class:P["list-wrapper"]},[a.value.map(u=>e("div",{class:P["select-item"],onClick:()=>L(u)},[e("div",{class:P["select-item-left"]},[e("div",{class:P["item-params"]},[e("span",null,[u.rackWide,f("X"),u.rackLong]),e("span",null,[u.rackCapacity,f("mm")]),e("span",null,[u.rackCode])]),e("div",{class:P["item-desc"]},[u.rackDescribe])]),e("div",{class:P["select-item-right"]},[e("div",{class:P.checked},[o.value==u.id?e(c("svg-icon"),{name:"icon-success"},null):null])])]))])])]})])}}),$=""+new URL("warehouse-empty.f9a25e20.png",import.meta.url).href,me=E({name:"SampleLib",setup(){let l=!1;const y=J(),_=v(!1),o=v(!1),r=v(!0),n=v(),a=v(),g=v([]),L=()=>{o.value=!0},u=v([]),T=()=>{y.push({path:"/bindSample"})},m=()=>{r.value=!0;const t=w.loading({message:"\u52A0\u8F7D\u4E2D...",overlay:!0,mask:!0,duration:0});le().then(x=>{if(r.value=!1,g.value=x.data.data.sort((C,z)=>C.rackPosition-z.rackPosition),a.value&&g.value.length){const C=g.value.findIndex(z=>z.rackPosition===a.value);C==-1?a.value=void 0:n.value=g.value[C].id}else n.value=void 0;g.value.length&&!a.value&&(n.value=g.value[0].id,a.value=g.value.sort((C,z)=>C.rackPosition-z.rackPosition)[0].rackPosition),a.value||(a.value=1),i(),t.clear()}).catch(()=>{r.value=!1})},i=()=>{n.value?oe({id:n.value}).then(t=>{u.value=t.data.rows}):u.value=[]},p=()=>{var t;if(((t=h.value)==null?void 0:t.outType)==1){w.fail("\u5F53\u524D\u4ED3\u4F4D\u5F85\u51FA\u4ED3\uFF0C\u7981\u6B62\u64CD\u4F5C\uFF01");return}_.value=!1,U.confirm({message:"\u8BF7\u786E\u8BA4\u5DF2\u4ECE\u4ED3\u4F4D\u4E2D\u53D6\u8D70\u9009\u4E2D\u7684\u76D8\u67B6",cancelButtonColor:"#fff",confirmButtonColor:"#00A9A9"}).then(()=>{ue({id:n.value}).then(()=>{w.success("\u51FA\u5E93\u6210\u529F"),setTimeout(()=>{m()},1500)})}).catch(()=>{console.log("\u53D6\u6D88\u4E86\u51FA\u5E93")})},k=()=>{var t;n.value=(t=g.value.find(x=>x.rackPosition==a.value))==null?void 0:t.id,i()},h=q(()=>g.value.find(t=>t.id==n.value));m();const j=t=>{const x=w.loading({message:"\u5165\u5E93\u4E2D...",duration:0,overlay:!0,mask:!0});ce({id:t,rackPosition:a.value}).then(()=>{x.clear(),w.success("\u5165\u5E93\u6210\u529F"),setTimeout(()=>{m()},1500)}).catch(()=>{x.clear()})},O=t=>{const x=t+1;return x>9?x:"0"+x},G=()=>{l=!0,cordova.plugins.barcodeScanner.scan(async function(t){if(t.text){const x=await Q({rackCode:t.text});x.data.data?de({rackPosition:a.value,id:x.data.data.id}).then(()=>{m()}):w("\u76D8\u67B6\u4E0D\u5B58\u5728")}setTimeout(()=>{l=!1},200)},function(t){console.log(t),setTimeout(()=>{l=!1},200)})},X=()=>{var t;if(((t=h.value)==null?void 0:t.outType)==1){w.fail("\u5F53\u524D\u4ED3\u4F4D\u5F85\u51FA\u4ED3\uFF0C\u7981\u6B62\u64CD\u4F5C\uFF01");return}y.push({path:"/bindSample",query:{id:n.value}})},W=t=>{l?t.preventDefault():R()};return V(()=>{document.addEventListener("backbutton",W)}),H(()=>{document.removeEventListener("backbutton",W)}),()=>{var t,x,C,z;return e(A,null,[e("div",{class:s["sample-lib"]},[e("div",{class:s["sample-wrapper"]},[e("div",{class:s["plate-lenged"]},[e(D,null,null)]),e(I,{hasList:g.value,selectPosition:a.value,"onUpdate:selectPosition":S=>a.value=S,onChangePosition:k},null)]),h.value?e("div",{class:s["disk-rack-wrapper"]},[e("div",{class:s["disk-top"]},[e("div",{class:s["disk-info"]},[e("div",{class:s["disk-icon"]},[e(c("svg-icon"),{name:"disk-icon"},null)]),e("div",{class:s["disk-text"]},[e("div",{class:s["disk-name"]},[(t=h.value)==null?void 0:t.rackWide,f("X"),(x=h.value)==null?void 0:x.rackLong," ",((C=h.value)==null?void 0:C.aperture)||"-",f("mm \u76D8\u67B6")]),e("div",{class:s["disk-no"]},[(z=h.value)==null?void 0:z.rackCode])])]),e(c("van-popover"),{class:"my-popover",show:_.value,"onUpdate:show":S=>_.value=S,theme:"dark",placement:"bottom-end"},{reference:()=>e("div",{class:s["disk-menu"]},[e(c("svg-icon"),{name:"dot-menu"},null)]),default:()=>e("div",{class:s["menu-list"]},[e("div",{class:s["menu-item"],onClick:X},[e("div",{class:s["menu-icon"]},[e(c("svg-icon"),{name:"icon-edit"},null)]),e("div",{class:s["menu-name"]},[f("\u7F16\u8F91")])]),e("div",{class:s["menu-item"],onClick:p},[e("div",{class:s["menu-icon"]},[e(c("svg-icon"),{name:"icon-export"},null)]),e("div",{class:s["menu-name"]},[f("\u6574\u67B6\u51FA\u5E93")])])])})]),e("div",{class:s["disk-list"]},[u.value.map((S,K)=>e("div",{class:s["disk-item"]},[e("div",{class:s["disk-item-index"]},[O(K)]),e("div",{class:s["disk-item-content"]},[e("div",{class:s["disk-item-name"]},[S.sampleName]),e("div",{class:s["disk-item-no"]},[S.sampleCode])])]))])]):null,!h.value&&!r.value?e("div",{class:s["empty-wrapper"]},[e(c("van-empty"),{image:$,description:"\u5F53\u524D\u4ED3\u4F4D\u6682\u65E0\u76D8\u67B6"},null),e("div",{class:s["select-btn"],onClick:L},[f("\u4ECE\u5217\u8868\u9009\u62E9\u5165\u5E93")]),e("div",{class:s["scan-btn"],onClick:G},[f("\u626B\u76D8\u67B6\u7801\u5165\u5E93")])]):null,e("div",{class:s["scan-code"],onClick:T},[e("div",{class:s["scan-icon"]},[e(c("svg-icon"),{name:"icon-scan"},null)]),e("div",{class:s["scan-text"]},[f("\u6837\u54C1\u7ED1\u5B9A")])])]),e(re,{show:o.value,"onUpdate:show":S=>o.value=S,onConfirm:j},null)])}}}),d={"sample-lib":"_sample-lib_dnu0u_1","sample-wrapper":"_sample-wrapper_dnu0u_4","plate-lenged":"_plate-lenged_dnu0u_8","disk-rack-wrapper":"_disk-rack-wrapper_dnu0u_11","disk-top":"_disk-top_dnu0u_15","disk-info":"_disk-info_dnu0u_20","disk-icon":"_disk-icon_dnu0u_23","disk-text":"_disk-text_dnu0u_28","disk-name":"_disk-name_dnu0u_33","disk-no":"_disk-no_dnu0u_37","disk-menu":"_disk-menu_dnu0u_41","disk-list":"_disk-list_dnu0u_51","disk-item":"_disk-item_dnu0u_51","flex-box":"_flex-box_dnu0u_61","flex-box-label":"_flex-box-label_dnu0u_70","flex-box-value":"_flex-box-value_dnu0u_73","empty-wrapper":"_empty-wrapper_dnu0u_76","select-btn":"_select-btn_dnu0u_76","scan-btn":"_scan-btn_dnu0u_89","scan-code":"_scan-code_dnu0u_100","scan-icon":"_scan-icon_dnu0u_116","scan-text":"_scan-text_dnu0u_120","menu-list":"_menu-list_dnu0u_125","menu-item":"_menu-item_dnu0u_128","menu-name":"_menu-name_dnu0u_132","menu-icon":"_menu-icon_dnu0u_138"},N=E({name:"ConsumableLib",props:{type:{type:Number,default:1}},setup(l){const y=v(!1),_=v(!1),o=v(),r=v(),n=q(()=>a.value.find(i=>i.id==o.value)),a=v([]),g=()=>{_.value=!0;const i=w.loading({message:"\u52A0\u8F7D\u4E2D...",overlay:!0,mask:!0,duration:0});Y({type:l.type}).then(p=>{_.value=!1,a.value=p.data.data.sort((k,h)=>k.rackPosition-h.rackPosition),r.value&&a.value.length?a.value.findIndex(h=>h.rackPosition===r.value)==-1?r.value=void 0:o.value=a.value[0].id:o.value=void 0,a.value.length&&!r.value&&(o.value=a.value[0].id,r.value=a.value.sort((k,h)=>k.rackPosition-h.rackPosition)[0].rackPosition),r.value||(r.value=1),u(),i.clear()}).catch(()=>{_.value=!1})},L=v([]),u=()=>{var i;(i=n.value)!=null&&i.rackCode?Z({rackCode:n.value.rackCode,type:l.type}).then(p=>{L.value=p.data.data.lists}):L.value=[]},T=()=>{var i;o.value=(i=a.value.find(p=>p.rackPosition==r.value))==null?void 0:i.id,u()},m=()=>{var i;if(((i=n.value)==null?void 0:i.outType)==1){w.fail("\u5F53\u524D\u4ED3\u4F4D\u5F85\u51FA\u4ED3\uFF0C\u7981\u6B62\u64CD\u4F5C\uFF01");return}y.value=!1,U.confirm({message:"\u8BF7\u786E\u8BA4\u5DF2\u4ECE\u4ED3\u4F4D\u4E2D\u53D6\u8D70\u9009\u4E2D\u7684\u76D8\u67B6",cancelButtonColor:"#fff",confirmButtonColor:"#00A9A9"}).then(()=>{var p;ee({rackCode:(p=n.value)==null?void 0:p.rackCode,type:l.type}).then(()=>{w.success("\u51FA\u5E93\u6210\u529F"),setTimeout(()=>{g()},1500)})}).catch(()=>{console.log("\u53D6\u6D88\u4E86\u51FA\u5E93")})};return g(),()=>{var i,p,k,h;return e(A,null,[e("div",{class:d["sample-lib"]},[e("div",{class:d["sample-wrapper"]},[e("div",{class:d["plate-lenged"]},[e(D,null,null)]),e(I,{hasList:a.value,selectPosition:r.value,"onUpdate:selectPosition":j=>r.value=j,onChangePosition:T},null)]),n.value?e("div",{class:d["disk-rack-wrapper"]},[e("div",{class:d["disk-top"]},[e("div",{class:d["disk-info"]},[e("div",{class:d["disk-icon"]},[e(c("svg-icon"),{name:"disk-icon"},null)]),e("div",{class:d["disk-text"]},[e("div",{class:d["disk-name"]},[(i=n.value)==null?void 0:i.rackWide,f("X"),(p=n.value)==null?void 0:p.rackLong," ",((k=n.value)==null?void 0:k.aperture)||"-",f("mm \u76D8\u67B6")]),e("div",{class:d["disk-no"]},[(h=n.value)==null?void 0:h.rackCode])])]),e(c("van-popover"),{class:"my-popover",show:y.value,"onUpdate:show":j=>y.value=j,theme:"dark",placement:"bottom-end"},{reference:()=>e("div",{class:d["disk-menu"]},[e(c("svg-icon"),{name:"dot-menu"},null)]),default:()=>e("div",{class:d["menu-list"],onClick:m},[e("div",{class:d["menu-item"]},[e("div",{class:d["menu-icon"]},[e(c("svg-icon"),{name:"icon-export"},null)]),e("div",{class:d["menu-name"]},[f("\u6574\u67B6\u51FA\u5E93")])])])})]),e("div",{class:d["disk-list"]},[L.value.map(j=>e("div",{class:d["disk-item"]},[e("div",{class:d["flex-box"]},[e("div",{class:d["flex-box-label"]},[f("\u7BA1\u6750\u540D\u79F0")]),e("div",{class:d["flex-box-value"]},[j.sampleName])]),e("div",{class:d["flex-box"]},[e("div",{class:d["flex-box-label"]},[f("\u7BA1\u6750\u6570\u91CF")]),e("div",{class:d["flex-box-value"]},[j.sampleNumber])])]))])]):null,!n.value&&!_.value?e("div",{class:d["empty-wrapper"]},[e(c("van-empty"),{image:$,description:"\u5F53\u524D\u4ED3\u4F4D\u6682\u65E0\u76D8\u67B6"},null)]):null])])}}}),b={"sample-lib":"_sample-lib_14a5z_1","sample-wrapper":"_sample-wrapper_14a5z_4","plate-lenged":"_plate-lenged_14a5z_8","disk-rack-wrapper":"_disk-rack-wrapper_14a5z_11","disk-top":"_disk-top_14a5z_15","disk-info":"_disk-info_14a5z_20","disk-icon":"_disk-icon_14a5z_25","disk-text":"_disk-text_14a5z_30","disk-name":"_disk-name_14a5z_36","disk-no":"_disk-no_14a5z_41","disk-vol":"_disk-vol_14a5z_45","disk-menu":"_disk-menu_14a5z_51","disk-list":"_disk-list_14a5z_61","disk-item":"_disk-item_14a5z_61","disk-item-index":"_disk-item-index_14a5z_69","disk-item-content":"_disk-item-content_14a5z_75","disk-item-name":"_disk-item-name_14a5z_75","disk-item-no":"_disk-item-no_14a5z_81","empty-wrapper":"_empty-wrapper_14a5z_86","select-btn":"_select-btn_14a5z_86","scan-btn":"_scan-btn_14a5z_99","scan-code":"_scan-code_14a5z_110","scan-icon":"_scan-icon_14a5z_126","scan-text":"_scan-text_14a5z_130","menu-list":"_menu-list_14a5z_135","menu-item":"_menu-item_14a5z_138","menu-name":"_menu-name_14a5z_142","menu-icon":"_menu-icon_14a5z_148"},ve=""+new URL("reagent-empty.3eeac3fa.png",import.meta.url).href,_e=E({name:"ReagentLib",setup(){const l=v(!1),y=v(!1),_=v(),o=v(),r=q(()=>a.value.find(m=>m.id==_.value)),n=v(),a=v([]),g=()=>{y.value=!0;const m=w.loading({message:"\u52A0\u8F7D\u4E2D...",overlay:!0,mask:!0,duration:0});ae().then(i=>{y.value=!1,a.value=i.data.data.sort((p,k)=>p.rackPosition-k.rackPosition),o.value&&a.value.length?a.value.findIndex(k=>k.rackPosition===o.value)==-1?o.value=void 0:_.value=a.value[0].id:_.value=void 0,a.value.length&&!o.value&&(_.value=a.value[0].id,o.value=a.value.sort((p,k)=>p.rackPosition-k.rackPosition)[0].rackPosition),o.value||(o.value=1),L(),m.clear()}).catch(()=>{y.value=!1})},L=()=>{var m;(m=r.value)!=null&&m.rackCode?se({id:_.value}).then(i=>{n.value=i.data.data}):n.value=void 0},u=()=>{var m;_.value=(m=a.value.find(i=>i.rackPosition==o.value))==null?void 0:m.id,L()},T=()=>{var m;if(((m=r.value)==null?void 0:m.outType)==1){w.fail("\u5F53\u524D\u4ED3\u4F4D\u5F85\u51FA\u4ED3\uFF0C\u7981\u6B62\u64CD\u4F5C\uFF01");return}l.value=!1,U.confirm({message:"\u8BF7\u786E\u8BA4\u5DF2\u4ECE\u4ED3\u4F4D\u4E2D\u53D6\u8D70\u9009\u4E2D\u7684\u8BD5\u5242",cancelButtonColor:"#fff",confirmButtonColor:"#00A9A9"}).then(()=>{ne({id:_.value}).then(()=>{w.success("\u51FA\u5E93\u6210\u529F"),setTimeout(()=>{g()},1500)})}).catch(()=>{console.log("\u53D6\u6D88\u4E86\u51FA\u5E93")})};return g(),()=>{var m,i,p;return e(A,null,[e("div",{class:b["sample-lib"]},[e("div",{class:b["sample-wrapper"]},[e("div",{class:b["plate-lenged"]},[e(D,{hasText:"\u5DF2\u6709\u8BD5\u5242",noText:"\u6682\u65E0\u8BD5\u5242"},null)]),e(I,{hasList:a.value,selectPosition:o.value,"onUpdate:selectPosition":k=>o.value=k,onChangePosition:u},null)]),r.value?e("div",{class:b["disk-rack-wrapper"]},[e("div",{class:b["disk-top"]},[e("div",{class:b["disk-info"]},[e("div",{class:b["disk-icon"]},[e(c("svg-icon"),{name:"icon-reagent"},null)]),e("div",{class:b["disk-text"]},[e("div",{class:b["disk-name"]},[(m=n.value)==null?void 0:m.reagentRemarks]),e("div",{class:b["disk-no"]},[(i=n.value)==null?void 0:i.reagentCode])]),e("div",{class:b["disk-vol"]},[(p=n.value)==null?void 0:p.reagentCapacity,f("L")])]),e(c("van-popover"),{class:"my-popover",show:l.value,"onUpdate:show":k=>l.value=k,theme:"dark",placement:"bottom-end"},{reference:()=>e("div",{class:b["disk-menu"]},[e(c("svg-icon"),{name:"dot-menu"},null)]),default:()=>e("div",{class:b["menu-list"],onClick:T},[e("div",{class:b["menu-item"]},[e("div",{class:b["menu-icon"]},[e(c("svg-icon"),{name:"icon-export"},null)]),e("div",{class:b["menu-name"]},[f("\u6574\u67B6\u51FA\u5E93")])])])})])]):null,!r.value&&!y.value?e("div",{class:b["empty-wrapper"]},[e(c("van-empty"),{image:ve,description:"\u5F53\u524D\u4ED3\u4F4D\u6682\u65E0\u8BD5\u5242"},null)]):null])])}}}),xe=E({name:"LibManage",setup(){const l=v(0);return()=>e(A,null,[e("div",{class:te["lib-manage"]},[e(c("van-nav-bar"),{title:"\u5E93\u7BA1\u7406",fixed:!0,placeholder:!0,"left-arrow":!0,border:!1,onClickLeft:R},null),e(c("van-tabs"),{active:l.value,"onUpdate:active":y=>l.value=y,border:!0,sticky:!0,"offset-top":"1.22667rem"},{default:()=>[e(c("van-tab"),{title:"\u6837\u54C1\u5E93"},{default:()=>[e(me,null,null)]}),e(c("van-tab"),{title:"\u7BA1\u6750\u5E93"},{default:()=>[e(N,{type:1},null)]}),e(c("van-tab"),{title:"\u8017\u6750\u5E93"},{default:()=>[e(N,{type:2},null)]}),e(c("van-tab"),{title:"\u8BD5\u5242\u5E93"},{default:()=>[e(_e,null,null)]})]})])])}});export{xe as default};
