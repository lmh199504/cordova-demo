import{o as g}from"./back.aed9095d.js";import{d as w,r as f,c as e,a as r,l as V,w as N,o as z,j as L,b as o,h as R,m as P,T as y,D as v,n as U}from"./index.70606483.js";import{f as O,b as G,d as K,g as M,h as $}from"./index.e35daa60.js";const H="_icon_y535y_4",J="_content_y535y_43",a={"empty-wrapper":"_empty-wrapper_y535y_1","icon-bind":"_icon-bind_y535y_4",icon:H,"text-wrapper":"_text-wrapper_y535y_14","bind-title":"_bind-title_y535y_20","bind-step":"_bind-step_y535y_26","bind-num":"_bind-num_y535y_31","btn-wrapper":"_btn-wrapper_y535y_35","nav-right":"_nav-right_y535y_39",content:J,"disk-info":"_disk-info_y535y_50","flex-box-between":"_flex-box-between_y535y_54","warehouse-place":"_warehouse-place_y535y_60","scan-icon":"_scan-icon_y535y_64","disk-info-box":"_disk-info-box_y535y_69","disk-info-left":"_disk-info-left_y535y_75","disk-info-right":"_disk-info-right_y535y_79","black-line":"_black-line_y535y_84","sample-info":"_sample-info_y535y_88","sample-title":"_sample-title_y535y_96","sample-list":"_sample-list_y535y_101","sample-list-padding":"_sample-list-padding_y535y_107","add-btn":"_add-btn_y535y_110","add-icon":"_add-icon_y535y_122","full-text":"_full-text_y535y_129","bottom-btn":"_bottom-btn_y535y_135","toggle-all-text":"_toggle-all-text_y535y_150","cancel-btn":"_cancel-btn_y535y_154","confirm-btn":"_confirm-btn_y535y_164"},_={"sample-check-item":"_sample-check-item_3qpjz_1","sample-check-num":"_sample-check-num_3qpjz_10","sample-item-cener":"_sample-item-cener_3qpjz_15","sample-item-name":"_sample-item-name_3qpjz_20","sample-item-no":"_sample-item-no_3qpjz_26"},Q=w({name:"CheckItem",props:{name:{type:[String,Number],default:""},i:{type:Number,default:1},data:{type:Object,default:()=>({})}},setup(d){const b=n=>{n.stopPropagation()},i=f(),u=()=>{i.value.toggle()},c=n=>{const m=n+1;return m>9?m:"0"+m};return()=>e("div",{class:_["sample-check-item"],onClick:u},[e("div",{class:_["sample-check-num"]},[c(d.i)]),e("div",{class:_["sample-item-cener"]},[e("div",{class:_["sample-item-name"]},[d.data.name]),e("div",{class:_["sample-item-no"]},[d.data.code])]),e("div",{class:_["check-box"]},[e("div",null,[e(r("van-checkbox"),{ref:i,name:d.name,onClick:n=>b(n)},null)])])])}});function W(d){return typeof d=="function"||Object.prototype.toString.call(d)==="[object Object]"&&!R(d)}const ae=w({name:"BindSample",setup(){const d=P(),b=f(!1),i=V({rackCode:"",rackDescribe:"",fullCount:0}),u=f();u.value=d.query.id,d.query.id&&(b.value=!0);const c=f([]),n=f([]),m=f(!1);N(c,()=>{c.value.length===n.value.length?m.value=!0:m.value=!1});const k=f(),A=()=>{var l,t;m.value?(l=k.value)==null||l.toggleAll(!0):(t=k.value)==null||t.toggleAll(!1)};let p=!1;const F=()=>{p=!0,cordova.plugins.barcodeScanner.scan(function(l){if(l.text){const t=y.loading({message:"\u52A0\u8F7D\u4E2D...",duration:0,mask:!0});O({sampleCode:l.text}).then(s=>{var D;t.clear(),(D=s.data)!=null&&D.data?n.value.findIndex(I=>{var B;return I.id==((B=s.data.data)==null?void 0:B.id)})==-1?(n.value.push({id:s.data.data.id,code:s.data.data.sampleCode,name:s.data.data.sampleName,number:0,position:null}),T()):v.alert({title:"\u63D0\u793A",message:"\u6837\u54C1\u5DF2\u5728\u5217\u8868\u4E2D",confirmButtonColor:"#00A9A9"}):v.alert({title:"\u63D0\u793A",message:"\u6837\u54C1\u4E0D\u5B58\u5728",confirmButtonColor:"#00A9A9"})}).catch(()=>{t.clear()})}setTimeout(()=>{p=!1},200)},function(){setTimeout(()=>{p=!1},200),v.alert({title:"\u63D0\u793A",message:"\u626B\u63CF\u5931\u8D25",confirmButtonColor:"#00A9A9"})})},S=()=>{v.confirm({title:"\u63D0\u793A",message:"\u5F53\u524D\u7ED1\u5B9A\u4FE1\u606F\u672A\u4FDD\u5B58\uFF0C\u662F\u5426\u4FDD\u5B58\uFF1F",confirmButtonText:"\u4FDD\u5B58",cancelButtonText:"\u4E0D\u4FDD\u5B58",cancelButtonColor:"#fff",confirmButtonColor:"#00A9A9"}).then(()=>{x(h)}).catch(()=>{E()})},h=()=>{p=!0,cordova.plugins.barcodeScanner.scan(async function(l){try{if(l.text){const t=await G({rackCode:l.text});t.data.data?(u.value=t.data.data.id,n.value=(t.data.data.lists||[]).map(s=>({id:s.id,code:s.sampleCode,name:s.sampleName,number:0,position:null})),i.rackCode=t.data.data.rackCode,i.rackDescribe=t.data.data.remarks,i.fullCount=t.data.data.fullCount):v.alert({title:"\u63D0\u793A",message:"\u76D8\u67B6\u4E0D\u5B58\u5728",confirmButtonColor:"#00A9A9"})}setTimeout(()=>{p=!1},200)}catch{setTimeout(()=>{p=!1},200)}},function(){setTimeout(()=>{p=!1},10),v.alert({title:"\u63D0\u793A",message:"\u626B\u63CF\u5931\u8D25",confirmButtonColor:"#00A9A9"})})},C=l=>{console.log(p),p?l.preventDefault():g()};z(()=>{document.addEventListener("backbutton",C)}),L(()=>{document.removeEventListener("backbutton",C)});const T=()=>{U(()=>{var l;(l=document.getElementById("scan-addd-btn"))==null||l.scrollIntoView({behavior:"smooth",block:"start"})})},q=()=>{if(u.value){const l=y.loading({message:"\u52A0\u8F7D\u4E2D...",duration:0,overlay:!0,mask:!0});K({id:u.value}).then(t=>{t.data.data&&(n.value=t.data.data.details,i.rackCode=t.data.data.rackCode),l.clear()}).catch(()=>{console.log("adsfads")})}},E=()=>{i.rackCode="",i.rackDescribe="",i.fullCount=0,n.value=[],u.value=""},j=()=>{for(let l=0;l<c.value.length;l++){const t=n.value.findIndex(s=>s.id==c.value[l]);n.value.splice(t,1)}c.value=[]};q();const x=async l=>{const t=y.loading({message:"\u4FDD\u5B58\u4E2D...",duration:0,mask:!0});try{b.value?await $({id:Number(u.value),ids:n.value.map(s=>s.id),rackDescribe:i.rackDescribe}):await M({id:Number(u.value),ids:n.value.map(s=>s.id),rackDescribe:i.rackDescribe}),t.clear(),y.success("\u4FDD\u5B58\u6210\u529F"),l&&typeof l=="function"&&setTimeout(()=>{l()},1e3)}catch{t.clear()}};return()=>{let l;return e("div",{class:a["bind-sample"]},[e(r("van-nav-bar"),{title:"\u6837\u54C1\u7ED1\u5B9A",fixed:!0,placeholder:!0,"left-arrow":!0,border:!1,onClickLeft:g},{right:()=>e("div",null,[u.value?e("div",{onClick:()=>x(g),class:a["nav-right"]},[o("\u4FDD\u5B58")]):null])}),u.value?e("div",{class:a.content},[e("div",{class:a["disk-info"]},[e("div",{class:a["flex-box-between"]},[e("div",{class:a["warehouse-place"]},[o("\u76D8\u67B6\u4FE1\u606F")]),b.value?null:e("div",{class:a["scan-icon"],onClick:S},[e(r("svg-icon"),{name:"icon-scans"},null)])]),e("div",{class:a["disk-info-box"]},[e("div",{class:a["disk-info-left"]},[o("\u76D8\u67B6\u7F16\u7801")]),e("div",{class:a["disk-info-right"]},[i.rackCode])]),e("div",{class:a["disk-info-box"]},[e("div",{class:a["disk-info-left"]},[o("\u76D8\u67B6\u63CF\u8FF0")]),e("div",{class:a["disk-info-right"]},[e(r("van-field"),{style:"padding: 0",modelValue:i.rackDescribe,"onUpdate:modelValue":t=>i.rackDescribe=t,placeholder:"\u8BF7\u8F93\u5165",autosize:!0},null)])])]),e("div",{class:a["black-line"]},null),e("div",{class:a["sample-info"]},[e("div",{class:a["sample-title"]},[o("\u6837\u54C1\u4FE1\u606F")]),e("div",{class:[a["sample-list"],c.value.length?a["sample-list-padding"]:null]},[e(r("van-checkbox-group"),{modelValue:c.value,"onUpdate:modelValue":t=>c.value=t,ref:k},W(l=n.value.map((t,s)=>e(Q,{name:t.id,i:s,data:t},null)))?l:{default:()=>[l]}),n.value.length>=i.fullCount?e("div",{class:a["full-text"]},[o("-\u6837\u54C1\u5DF2\u6EE1-")]):e("div",{class:a["add-btn"],onClick:F},[e("div",{class:a["add-icon"]},[e(r("svg-icon"),{name:"icon-scans"},null)]),e("div",{id:"scan-addd-btn",class:a["add-text"]},[o("\u6DFB\u52A0\u6837\u54C1")])])])]),c.value.length!=0?e("div",{class:a["bottom-btn"]},[e("div",null,[e(r("van-checkbox"),{modelValue:m.value,"onUpdate:modelValue":t=>m.value=t,onClick:A},{default:()=>[e("span",{class:a["toggle-all-text"]},[o("\u5168\u9009")])]})]),e("div",null,[e(r("van-button"),{onClick:()=>c.value=[],plain:!0,size:"small",class:a["cancel-btn"]},{default:()=>[o("\u53D6\u6D88")]}),e(r("van-button"),{onClick:j,size:"small",color:"#FF4747",class:a["confirm-btn"]},{default:()=>[o("\u79FB\u9664"),c.value.length,o("\u9879")]})])]):null]):e("div",{class:a["empty-wrapper"]},[e("div",{class:a["icon-bind"]},[e(r("svg-icon"),{name:"icon-bind",class:a.icon},null)]),e("div",{class:a["text-wrapper"]},[e("div",{class:a["bind-title"]},[o("\u5C06\u6837\u54C1\u7ED1\u5B9A\u5230\u76D8\u67B6\u4E2D")]),e("div",{class:a["bind-step"]},[e("span",{class:a["bind-num"]},[o("01")]),e("span",null,[o("\u626B\u63CF\u8981\u653E\u7F6E\u6837\u54C1\u7684\u76D8\u67B6")])]),e("div",{class:a["bind-step"]},[e("span",{class:a["bind-num"]},[o("02")]),e("span",null,[o("\u6DFB\u52A0\u8981\u68C0\u6D4B\u7684\u6837\u54C1")])])]),e("div",{class:a["btn-wrapper"]},[e(r("van-button"),{type:"primary",block:!0,onClick:h},{default:()=>[o("\u626B\u63CF\u76D8\u67B6")]})])])])}}});export{ae as default};
